<!doctype html>
<html lang="en">

<!-- Head -->

<head>
    <!-- Page Meta Tags-->
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">

    <!-- Custom Google Fonts-->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Oswald:wght@500;600&family=Roboto:wght@300;400;700&display=auto"
        rel="stylesheet">

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="./assets/images/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./assets/images/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./assets/images/favicon/favicon-16x16.png">
    <link rel="mask-icon" href="./assets/images/favicon/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">

    <!-- Vendor CSS -->
    <link rel="stylesheet" href="./assets/css/libs.bundle.css" />

    <!-- Main CSS -->
    <link rel="stylesheet" href="./assets/css/theme.bundle.css" />

    <!-- Fix for custom scrollbar if JS is disabled-->
    <noscript>
        <style>
            /**
          * Reinstate scrolling for non-JS clients
          */
            .simplebar-content-wrapper {
                overflow: auto;
            }
        </style>
    </noscript>

    <!-- Page Title -->
    <title>Furniture Emporium</title>

</head>

<body class="">

    <!-- Main Section-->
    <section class="mt-0 overflow-lg-hidden  vh-lg-100">
        <!-- Page Content Goes Here -->
        <div class="container">
            <div class="row g-0 vh-lg-100">
                <div class="col-12 col-lg-7 pt-5 pt-lg-10">
                    <div class="pe-lg-5">
                        <!-- Logo-->
                        <a class="navbar-brand fw-bold fs-3 flex-shrink-0 mx-0 px-0" href="./index.html">
                            <div class="d-flex align-items-center">
                                <svg class="f-w-7" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 77.53 72.26">
                                    <path
                                        d="M10.43,54.2h0L0,36.13,10.43,18.06,20.86,0H41.72L10.43,54.2Zm67.1-7.83L73,54.2,68.49,62,45,48.47,31.29,72.26H20.86l-5.22-9L52.15,0H62.58l5.21,9L54.06,32.82,77.53,46.37Z"
                                        fill="currentColor" fill-rule="evenodd" />
                                </svg>
                            </div>
                        </a>
                        <!-- / Logo-->
                        <nav class="d-none d-md-block">
                            <ul
                                class="list-unstyled d-flex justify-content-start mt-4 align-items-center fw-bolder small">
                                <li class="me-4"><a class="nav-link-checkout active" href="./cart.html">Your Cart</a>
                                </li>
                                <li class="me-4"><a class="nav-link-chec " href="./checkout.html">Checkout & Payment</a>
                                </li>
                                <!-- <li class="me-4"><a class="nav-link-checkout "
                                        href="./checkout-shipping.html">Shipping</a></li> -->
                                <!-- <li><a class="nav-link-checkout nav-link-last "
                                        href="./checkout-payment.html">Payment</a></li> -->
                            </ul>
                        </nav>
                        <div class="mt-5">
                            <h3 class="fs-5 fw-bolder mb-0 border-bottom pb-4">Your Cart</h3>
                            <div class="table-responsive" style="overflow-y: visible; max-height: 400px">
                                <table class="table align-middle">
                                    <tbody class="border-0" id="cartlisting">
                                        <!-- Cart Item-->
                                        <!-- <div class="row mx-0 py-4 g-0 border-bottom">
                                            <div class="col-2 position-relative">
                                                <picture class="d-block border">
                                                    <img class="img-fluid"
                                                        src="./assets/images/products/product-cart-1.jpg"
                                                        alt="HTML Bootstrap Template by Pixel Rocket">
                                                </picture>
                                            </div>
                                            <div class="col-9 offset-1">
                                                <div>
                                                    <h6 class="justify-content-between d-flex align-items-start mb-2">
                                                        Nike Air VaporMax 2021
                                                        <i class="ri-close-line ms-3"></i>
                                                    </h6>
                                                    <span class="d-block text-muted fw-bolder text-uppercase fs-9">Size:
                                                        9 / Qty: 1</span>
                                                </div>
                                                <p class="fw-bolder text-end text-muted m-0">$85.00</p>
                                            </div>
                                        </div> -->
                                        <!-- / Cart Item-->
                                        <!-- Cart Item-->
                                        <!-- <div class="row mx-0 py-4 g-0 border-bottom">
                                            <div class="col-2 position-relative">
                                                <picture class="d-block border">
                                                    <img class="img-fluid"
                                                        src="./assets/images/products/product-cart-2.jpg"
                                                        alt="HTML Bootstrap Template by Pixel Rocket">
                                                </picture>
                                            </div>
                                            <div class="col-9 offset-1">
                                                <div>
                                                    <h6 class="justify-content-between d-flex align-items-start mb-2">
                                                        Nike ZoomX Vaporfly
                                                        <i class="ri-close-line ms-3"></i>
                                                    </h6>
                                                    <span class="d-block text-muted fw-bolder text-uppercase fs-9">Size:
                                                        11 / Qty: 1</span>
                                                </div>
                                                <p class="fw-bolder text-end text-muted m-0">$125.00</p>
                                            </div> -->
                            </div> <!-- / Cart Item-->
                            </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-lg-5 bg-light pt-lg-10 aside-checkout pb-5 pb-lg-0 my-5 my-lg-0">
                <div class="p-4 py-lg-0 pe-lg-0 ps-lg-5">
                    <div id="totalAmount" class="pb-4 border-bottom">
                        <!-- <div class="d-flex flex-column flex-md-row justify-content-md-between mb-4 mb-md-2">
                                <div>
                                    <p class="m-0 fw-bold fs-5">Grand Total</p>
                                    <span class="text-muted small">Inc $45.89 sales tax</span>
                                </div>
                                <p class="m-0 fs-5 fw-bold">$422.99</p>
                            </div> -->
                    </div>
                    <!-- <div class="py-4">
                       COUPON ADDING INPUT -->
                    <!-- <div class="input-group mb-0">
                            <input type="text" class="form-control" placeholder="Enter coupon code">
                            <button class="btn btn-secondary btn-sm px-4">Apply</button>
                        </div>
                   </div> -->
                    <a href="./checkout.html" class="btn btn-dark w-100 text-center" role="button">Proceed to
                        checkout</a>
                    <!-- <div
                        style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100px; padding-top: 20px;">
                        <button
                            style="padding: 0.6em 1em; border: 4px solid #000000; transition: ease-in-out 0.3s; background-color: transparent; color: #000000; font-weight: bolder; font-size: 16px;"
                            onmouseover="this.style.transform='scale(1.2) rotate(10deg)'; this.style.backgroundColor='#000000'; this.style.color='white';"
                            onmouseout="this.style.transform=''; this.style.backgroundColor='transparent'; this.style.color='#000000';">
                            COUPON HERE</button>
                    </div> -->

                </div>


            </div>
        </div>
        </div>
        <!-- /Page Content -->
    </section>
    <!-- / Main Section-->
    <!-- AUTH -->
    <script src="./assets/js/auth.js"></script>
    <!-- Vendor JS -->
    <script src="./assets/js/vendor.bundle.js"></script>

    <!-- Theme JS -->
    <script src="./assets/js/theme.bundle.js"></script>
    <script>
        const token = localStorage.getItem('token');
        const headers = {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
        };
        showCartItems();

        let products = [];

        function showCartItems() {
            if (!token) {
                console.error('Authorization token not found');
                return;
            }


            fetch('http://localhost:5001/cart/showcart', {
                method: 'GET',
                headers: headers,
            })
                .then(response => response.json())
                .then(data => {
                    const cartInfo = data;
                    const cart = data.cartProducts;

                    products = cart;
                    setData(cart);
                    setTotal(cartInfo);
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        function setData(products) {
            const productnContainer = document.getElementById("cartlisting");
            // Clear existing content in the banner container
            productnContainer.innerHTML = "";
            products.forEach(element => {
                console.log("element:", element);
                const productCard = document.createElement("div");
                productCard.className = "row mx-0 py-4 g-0 border-bottom";
                productCard.innerHTML = `
            <div class="col-2 position-relative">
                <picture class="d-block border">
                    <img class="img-fluid" src="${element.images[0]}" alt="F-Empo">
                </picture>
            </div>
            <div class="col-9 offset-1">
                <div>
                    <h6 class="justify-content-between d-flex align-items-start mb-2">
                        ${element.name}
                        <i class="ri-close-line ms-3 cursor-pointer" id="delete"></i>
                    </h6>
                
                    <span class="d-block text-muted fw-bolder text-uppercase fs-9">
                        <label for="quantity">Qty:</label>
                        <select style="cursor:pointer;" value="${element.quantity}" data-product-id="${element._id}" id="quantity-${element._id}" name="quantity">
                            <option value="1" ${element.quantity === 1 ? 'selected' : ''}>1</option>
                            <option value="2" ${element.quantity === 2 ? 'selected' : ''}>2</option>
                            <option value="3" ${element.quantity === 3 ? 'selected' : ''}>3</option>
                            <option value="4" ${element.quantity === 4 ? 'selected' : ''}>4</option>
                            <option value="5" ${element.quantity === 5 ? 'selected' : ''}>5</option>
                        </select>
                    </span>
                </div>
                <p class="fw-bolder text-end text-muted m-0">₹${element.quantity * element.price}</p>
            </div>`;


                productnContainer.appendChild(productCard);

                // Add event listener to each select element
                const selectElement = productCard.querySelector(`#quantity-${element._id}`);
                selectElement.addEventListener('change', async (event) => {
                    const selectedQuantity = event.target.value;
                    const productId = event.target.dataset.productId;

                    // Here, you can handle the selected quantity and product ID as needed
                    console.log(`Product ID: ${productId}, Selected Quantity: ${selectedQuantity}`);
                    const addToCartResponse = await fetch("http://localhost:5001/cart/addtocart", {

                        method: "POST",
                        headers: headers,
                        body: JSON.stringify({
                            productId: productId,
                            quantity: selectedQuantity,
                        })
                    })
                    if (addToCartResponse.ok) {
                        window.location.reload()
                    }
                    console.log("addToCartResponse", await addToCartResponse.json());
                });


                //remove product
                const closeElement = document.getElementById("delete");
                console.log("close", closeElement)
                closeElement.addEventListener("click", async (event) => {

                    const removeProduct = await fetch("http://localhost:5001/cart/removecart", {
                        method: "DELETE",
                        headers: headers,
                        body: JSON.stringify({
                            productId: element._id,
                        })
                    })
                    const data = await removeProduct.json()
                    if (removeProduct.ok) {
                        window.location.reload()
                    }
                    console.log("data", data)
                })

            });
        }
        // total amount - in cart
        function setTotal(cartInfo) {
            console.log("cartInfo", cartInfo)
            const priceContainer = document.getElementById("totalAmount");

            const priceTot = document.createElement("div");
            priceTot.innerHTML = `<div class="d-flex flex-column flex-md-row justify-content-md-between mb-4 mb-md-2">
                            <div>
                                <p class="m-0 fw-bold fs-5">Grand Total</p>
                                <span class="text-muted small"></span>
                            </div>
                            <p class="m-0 fs-5 fw-bold">₹${cartInfo.totalPrice}</p>
                        </div>`;

            priceContainer.appendChild(priceTot);
        }




    </script>
</body>

</html>